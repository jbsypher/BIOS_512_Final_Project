---
title: "FEMA Disaster Analysis"
author: "Jonathan Barta"
date: "2025-12-09"
output:
  html_document:
    toc: true
    toc_float: true
    theme: united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Introduction and Data Setup

This project analyzes the efficiency and equity of the United States federal disaster response system. By merging historical disaster data with county-level socioeconomic indicators, I explore whether a county’s wealth or disaster experience influences how quickly the US Federal Emergency Management Agency (FEMA) responds to emergencies.

#### Data Sources and Structure

The analysis utilizes two primary datasets merged on 5-digit FIPS county codes:

* **FEMA Disaster Declarations:** A historical dataset of all federally declared disasters (1953–2021) sourced from FEMA. It includes incident types, declaration dates, and aid program flags.

* **US Census Data (ACS):** Demographic data sourced via the tidycensus API (2021 ACS 5-Year Estimates), providing median household income, poverty counts, and population for every US county.

#### Preprocessing and Environment

The FEMA dataset was pre-cleaned by the provider to remove duplicate entries, requiring minimal manual cleaning. My preprocessing pipeline focused on feature engineering: calculating the response_time_days (declaration date minus incident begin date), log-transforming income distributions, and standardizing FIPS codes with leading zeros to ensure a successful merge with Census data.

The project was developed in a JupyterLab environment using an R kernel. The source code and raw data are version-controlled and hosted in a public GitHub repository, while the final reproducible report was generated using RMarkdown.

### Research Questions
In this analysis, I sought to answer four primary questions regarding the equity and efficiency of federal disaster response:

1.  **Response Time by Socioeconomic Status:** Do lower socioeconomic status (SES) counties experience slower federal response times compared to wealthier counties?
2.  **Response Time by Incident Type:** How does the type of disaster (e.g., Hurricane vs. Biological) impact the speed of the declaration process?
3.  **Patterns of Natural Disasters:** Are there distinct seasonal or operational patterns in when specific disasters occur?
4.  **The Aid Gap:** Is there an equitable distribution of "Individual Assistance" (cash aid) across different income levels, or does an "aid gap" exist?

### Imports and Data Processing

```{r imports}
# Import libraries
library(tidyverse)
library(tidycensus)
library(janitor)
library(ggplot2)
library(scales)
library(RColorBrewer)
library(lubridate)
library(viridis)

# Fetch US Census Data via API key (I would void this if I was using the API key for confidential work)
census_api_key("c33813f20630896066940adf9558ba62fa088eb5", install = TRUE, overwrite = TRUE)

# Fetch Census Data (Income & Population)
census_data <- get_acs(
  geography = "county",
  variables = c(
    median_income = "B19013_001",  # Median Household Income
    population = "B01003_001",     # Total Population
    poverty = "B17001_002"         # Count of people in poverty
  ),
  year = 2021,
  geometry = FALSE
) %>%
  select(GEOID, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate) %>%
  rename(fips = GEOID)

# Import US Disaster data
fema_data <- read_csv("us_disaster_declarations.csv") %>%
  janitor::clean_names()

fema_data <- fema_data %>%
  mutate(fips = str_pad(as.character(fips), 5, pad = "0")) %>%
  filter(!is.na(fips)) 

# Create target variable (Response Time)
fema_data <- fema_data %>%
  mutate(
    incident_begin_date = as.Date(incident_begin_date),
    declaration_date = as.Date(declaration_date),
    response_time_days = as.numeric(declaration_date - incident_begin_date) 
  ) %>%
  filter(response_time_days >= 0)

# Join US Census Data and US Disaster Data
project_df <- fema_data %>%
  left_join(census_data, by = "fips") %>%
  filter(!is.na(median_income)) 

# Aggregate metrics by county (Required for Wealth Plot and PCA)
county_metrics <- project_df %>%
  group_by(fips) %>%
  summarise(
    avg_response_time = mean(response_time_days, na.rm = TRUE),
    total_disasters = n(),
    median_income = first(median_income), 
    poverty = first(poverty)
  ) %>%
  mutate(log_median_income = log(median_income)) %>%
  ungroup() %>%
  filter(avg_response_time > 0)

glimpse(project_df)
```

## Analysis and Visualizations

### Figure 1: Response Time by County Wealth

I begin by examining if wealthier counties receive faster federal declarations. I use a linear regression model to verify the trend.

```{r viz_wealth}
# Linear Model for R-squared calculation
time_model <- lm(avg_response_time ~ log_median_income + poverty + total_disasters, data = county_metrics)

# Plot: Response time by Wealth
ggplot(county_metrics, aes(x = median_income, y = avg_response_time)) +
  geom_point(alpha = 0.5, color = "#4682B4") + 
  geom_smooth(method = "lm", color = "firebrick", se = FALSE) + 
  labs(
    title = "FEMA Response Speed Declines with County Wealth",
    subtitle = "Average Days from Incident Start to Federal Declaration (1959–2021)",
    x = "County Median Household Income",
    y = "Average Declaration Response Time (Days)",
    caption = paste("R-squared:", round(summary(time_model)$r.squared, 3))
  ) +
  scale_x_continuous(labels = scales::dollar) + 
  theme_minimal()
```

This regression reveals a statistically significant positive correlation between income and response time. Contrary to the assumption that wealthy areas receive preferential speed, higher median income is associated with a slightly slower federal declaration, suggesting these counties may rely on local resources during the initial phase of a disaster.

### Figure 2: FEMA Response Time by Incident Type (Trends)

Next, I control for the type of disaster.

```{r viz_incident_trends}
# Linear Regression Model
final_project_model <- lm(response_time_days ~ log(median_income) + incident_type, data = project_df)

# Create dummy data for plotting prediction lines
plot_data <- data.frame(median_income = seq(20000, 150000, by = 1000))

# Calculate Predicted Response Time
plot_data <- plot_data %>%
  mutate(
    Biological_Baseline = 6.5677 + (5.1137 * log(median_income)),
    Hurricane = 6.5677 + (5.1137 * log(median_income)) - 54.3421,
    Flood = 6.5677 + (5.1137 * log(median_income)) - 37.4668,
    Toxic_Substances = 6.5677 + (5.1137 * log(median_income)) + 68.5244
  ) %>%
  pivot_longer(cols = -median_income, names_to = "Incident_Type", values_to = "Predicted_Days")

# Visualization
ggplot(plot_data, aes(x = median_income, y = Predicted_Days, color = Incident_Type)) +
  geom_line(linewidth = 1.2) + 
  scale_color_manual(values = c(
    "Hurricane" = "#D9534F",          
    "Toxic_Substances" = "#5BC0DE",   
    "Flood" = "#F0AD4E",              
    "Biological_Baseline" = "gray50"  
  )) +
  labs(
    title = "Comparative FEMA Response Trends: Hurricanes are Fast",
    subtitle = "Predicted days to declaration based on County Income (Model Trends)",
    x = "County Median Income",
    y = "Predicted Response Time (Days)",
    caption = "Note: Parallel curves due to log-linear model structure."
  ) +
  scale_x_continuous(labels = dollar) + 
  theme_minimal()
```

While the type of disaster is the strongest predictor of speed, with Hurricanes (red) triggering the fastest declarations and Toxic Substances (blue) the slowest, the ‘wealth penalty’ remains consistent. The upward slope across all disaster types confirms that as county income rises, federal response time increases regardless of the specific incident.

### Figure 3: Disaster Seasonality Heat Map

To understand the seasonality of disasters, I analyze when specific disaster types occur most frequently.

```{r viz_heatmap}
# Prepare Data
heatmap_data <- project_df %>%
  mutate(month = month(incident_begin_date, label = TRUE, abbr = TRUE)) %>% 
  group_by(incident_type, month) %>%
  summarise(count = n()) %>%
  ungroup()

# Plot Heatmap
ggplot(heatmap_data, aes(x = month, y = incident_type, fill = count)) +
  geom_tile(color = "white") + 
  scale_fill_viridis_c(option = "magma", direction = -1) + 
  labs(
    title = "FEMA Demand Forecasting: When do Disasters Strike?",
    subtitle = "Frequency of declared disasters by Month and Type",
    x = "Month",
    y = "Incident Type",
    fill = "Total Events"
  ) +
  theme_minimal() +
  theme(
    panel.grid = element_blank(), 
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```

FEMA faces distinct operational peaks. The heat map shows that Flood events (yellow/orange) create consistent demand throughout the spring, while Hurricane events create extreme, concentrated demand in August and September. This seasonality dictates when federal resources are most stretched.

### Figure 4: County Risk Profiles (Labeled PCA)

Using Principal Component Analysis (PCA) and K-Means clustering, I group counties into four distinct "Risk Archetypes" based on their disaster history and socioeconomic status.


```{r viz_pca}
# --- 1. SETUP: Run PCA and Initial Clustering ---
pca_data <- county_metrics %>%
  select(avg_response_time, total_disasters, median_income, poverty)
scaled_pca_data <- scale(pca_data)
pca_result <- prcomp(scaled_pca_data, scale = FALSE)
pca_scores <- data.frame(pca_result$x[, 1:3]) 

# Run K-Means
set.seed(42) 
kmeans_result <- kmeans(pca_scores, centers = 4, nstart = 25)

# --- 2. CREATE AND FILTER DATASETS ---
cluster_plot_data_unfiltered <- pca_scores %>%
  mutate(cluster = as.factor(kmeans_result$cluster),
         fips = county_metrics$fips)

# Filter outliers (Horizontal only)
cluster_plot_data_cleaned <- cluster_plot_data_unfiltered %>%
  filter(PC1 > -7, PC2 < 8)

# --- 3. RERUN K-MEANS ON CLEANED DATA ---
pca_scores_cleaned <- cluster_plot_data_cleaned %>% select(PC1, PC2, PC3) 
set.seed(42) 
kmeans_result_cleaned <- kmeans(pca_scores_cleaned, centers = 4, nstart = 25)
cluster_plot_data_cleaned$cluster <- as.factor(kmeans_result_cleaned$cluster)

# --- 4. DYNAMIC NAMING (Fixed) ---
# Calculate centroids
centroids <- cluster_plot_data_cleaned %>%
  group_by(cluster) %>%
  summarise(pc1 = mean(PC1), pc2 = mean(PC2)) %>%
  mutate(cluster_int = as.integer(as.character(cluster))) 

# Identify IDs based on position
wealthy_id <- centroids %>% filter(pc2 == max(pc2)) %>% pull(cluster_int)
experienced_id <- centroids %>% filter(pc1 == min(pc1)) %>% pull(cluster_int)
inexperienced_id <- centroids %>% filter(pc1 == max(pc1)) %>% pull(cluster_int)
mid_id <- setdiff(centroids$cluster_int, c(wealthy_id, experienced_id, inexperienced_id))

# Define the exact Label Text
lbl_wealthy <- "Wealthy/High-Poverty Metro (quick)"
lbl_experienced <- "Experienced/Low-Income (quick)"
lbl_inexperienced <- "Little Experience/Low-Income (slow)"
lbl_suburban <- "Mid-Range Suburban (mid)"

# Create a safe mapping dataframe
cluster_map <- data.frame(
  cluster = factor(c(wealthy_id, experienced_id, inexperienced_id, mid_id)),
  label_text = c(lbl_wealthy, lbl_experienced, lbl_inexperienced, lbl_suburban)
)

# Join the labels to the data
cluster_plot_data_cleaned <- cluster_plot_data_cleaned %>%
  left_join(cluster_map, by = "cluster")

# Recalculate centroids with new labels
final_centroids <- cluster_plot_data_cleaned %>%
  group_by(label_text) %>%
  summarise(mean_pc1 = mean(PC1), mean_pc2 = mean(PC2)) %>%
  filter(!is.na(label_text))

# --- 5. CUSTOM COLORS (The Fix) ---
# Define specific hex codes for specific labels
custom_colors <- c()
custom_colors[lbl_wealthy] <- "#4DAF4A"       # Green
custom_colors[lbl_experienced] <- "#E41A1C"   # Red
custom_colors[lbl_suburban] <- "#984EA3"      # Purple
custom_colors[lbl_inexperienced] <- "#377EB8" # Blue

# --- 6. PLOT ---
pca_plot <- ggplot(cluster_plot_data_cleaned, aes(x = PC1, y = PC2, color = label_text)) +
  geom_point(alpha = 0.6) +
  geom_label(
    data = final_centroids,
    aes(x = mean_pc1, y = mean_pc2, label = label_text, fill = label_text),
    color = "white", fontface = "bold", size = 3.5, show.legend = FALSE
  ) +
  # Force the manual colors
  scale_color_manual(values = custom_colors) +
  scale_fill_manual(values = custom_colors) +
  labs(
    title = "County Risk Profiles based on FEMA History and Demographics",
    subtitle = "K-Means Clustering on Principal Components (PC1 vs. PC2)",
    x = "PC1 (FEMA System Stress/Experience Explained: 36.1%)", 
    y = "PC2 (Socioeconomic Status Explained: 28.9%)",
    color = "Cluster Archetype"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

print(pca_plot)
```

PCA and K-Means clustering identified four distinct county profiles. The most distinct contrast exists between Experienced/Low-Income counties (typically rural, high-frequency disaster zones with fast systems) and Wealthy/Metro counties (high asset value, complex systems).

### Figure 5: The Aid Gap (Aid Access by Wealth)

Finally, I analyze the probability of receiving "Individual Assistance" (cash aid). Despite experiencing slower response times, wealthier counties are actually more likely to receive this aid.

```{r viz_aid_gap}
# Prepare Data
aid_data <- project_df %>%
  filter(!is.na(median_income)) %>%
  mutate(
    income_quartile = ntile(median_income, 4), 
    income_label = case_when(
      income_quartile == 1 ~ "Poorest 25%",
      income_quartile == 2 ~ "Low-Mid",
      income_quartile == 3 ~ "High-Mid",
      income_quartile == 4 ~ "Richest 25%"
    )
  ) %>%
  mutate(income_label = factor(income_label, levels = c("Poorest 25%", "Low-Mid", "High-Mid", "Richest 25%"))) %>%
  group_by(income_label) %>%
  summarise(
    prob_ia = mean(ia_program_declared, na.rm = TRUE), 
    total = n()
  )

# Plot Bar Chart
ggplot(aid_data, aes(x = income_label, y = prob_ia, fill = income_label)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::percent(prob_ia, accuracy = 0.1)), vjust = -0.5) + 
  scale_y_continuous(labels = scales::percent) +
  scale_fill_brewer(palette = "Blues") +
  labs(
    title = "The Aid Gap: Wealthier Counties More Likely to Get Individual Assistance",
    subtitle = "Probability of 'Individual Assistance' (Cash) Declaration by Income Quartile",
    x = "County Socioeconomic Status",
    y = "Probability of IA Declaration"
  ) +
  theme_minimal()
```

This chart highlights a systemic paradox: while wealthier counties experience slower initial response times, they are 3.8% more likely to eventually receive Individual Assistance (cash aid) than the poorest counties. This suggests that administrative capacity to navigate federal bureaucracy may be a stronger driver of securing aid than raw humanitarian need.

## Conclusions and Future Work

### 1. Summary of Findings

This analysis examined over 60 years of FEMA disaster declarations to understand the relationship between socioeconomic status, disaster experience, and federal response. The results uncover a paradox of speed versus access: while lower-income areas receive faster declarations, wealthier areas are more successful at securing financial aid.

* **The "Speed" Findings (Regression):** The type of incident is the primary driver of response time (e.g., Hurricanes are processed ~54 days faster than Biological events). However, controlling for disaster type, **wealthier counties experience slower response times**. This suggests that affluent areas may have the local resources to manage the initial phase of a disaster without immediate federal intervention.

* **The "Risk" Archetypes (Clustering):** PCA and K-Means clustering identified four distinct county profiles. The most distinct contrast exists between "Experienced/Low-Income" counties (typically rural, high-frequency disaster zones with fast systems) and "Wealthy/Metro" counties (high asset value, complex systems).

* **The "Access" Paradox (Bar Chart):** Despite slower response times, **wealthier counties are 3.8% more likely to receive "Individual Assistance" (cash aid) than the poorest counties.** This contradicts the assumption that aid favors the most vulnerable. It suggests that administrative capacity (the ability to fill out forms and navigate bureaucracy) or higher property damage values in wealthy areas may play a larger role in securing aid than raw humanitarian need.

### 2. Policy Implications

The data suggests an operational efficiency gap. While the system is fast at declaring disasters in experienced, lower-income areas, the actual allocation of Individual Assistance skews toward wealthier regions. A potential policy recommendation is to **simplify the Individual Assistance application process** for "Tier 1" (Experienced/Low-Income) counties, reducing the administrative burden that may be preventing poorer regions from accessing funds they qualify for.

### 3. Limitations and Future Work

* **Temporal Bias:** This study merged historical disaster data (1953–2021) with a static snapshot of Census data from 2021. This assumes that the relative wealth ranking of counties has remained stable over 70 years, which introduces temporal bias. A more robust study would utilize decennial Census data to match economic conditions to the specific year of the disaster.

* **Damage Thresholds:** The dataset contains binary flags for aid programs but lacks specific dollar amounts for damages. Future analysis should incorporate "Public Assistance" (PA) dollar obligations to measure the *magnitude* of aid, not just the probability of declaration.